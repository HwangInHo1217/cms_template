<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>직원 관리</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #f8f9fa;
        }
        
        .page-header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        .stats-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            border-left: 4px solid #28a745;
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: bold;
            color: #28a745;
        }
        
        .stats-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .filter-section {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .table-header {
            background: #f8f9fa;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .staff-table {
            margin-bottom: 0;
        }
        
        .staff-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            vertical-align: middle;
        }
        
        .staff-table td {
            vertical-align: middle;
        }
        
        .status-badge {
            padding: 0.375rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-active {
            background-color: #d1edff;
            color: #0c63e4;
        }
        
        .status-inactive {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .role-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 500;
            margin: 0.1rem;
            display: inline-block;
        }
        
        .role-admin {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .role-diagnosis {
            background-color: #e7f3ff;
            color: #0066cc;
        }
        
        .role-counseling {
            background-color: #f0f9ff;
            color: #0891b2;
        }
        
        .role-extracurricular {
            background-color: #f3e8ff;
            color: #7c3aed;
        }
        
        .role-professor {
            background-color: #ecfdf5;
            color: #059669;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.25rem;
        }
        
        .btn-sm-custom {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 4px;
        }
        
        .bulk-actions {
            background: #e8f5e9;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: none;
        }
        
        .bulk-actions.show {
            display: block;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        
        .form-floating label {
            color: #6c757d;
        }
        
        .pagination-container {
            background: white;
            padding: 1rem 1.5rem;
            border-top: 1px solid #dee2e6;
        }
        
        .role-selection {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .role-category {
            margin-bottom: 1rem;
        }
        
        .role-category h6 {
            color: #495057;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .permission-item {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
        }
        
        .department-badge {
            background-color: #e9ecef;
            color: #495057;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                flex-direction: column;
            }
            
            .table-responsive {
                font-size: 0.875rem;
            }
            
            .stats-card {
                text-align: center;
            }
            
            .role-badge {
                display: block;
                margin-bottom: 0.25rem;
            }
        }
    </style>
</head>
<body>
    <!-- 페이지 헤더 -->
    <div class="page-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1><i class="bi bi-person-badge"></i> 직원 관리</h1>
                    <p class="mb-0">교직원 계정 생성, 권한 관리 및 상태 변경</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <button class="btn btn-light me-2" onclick="exportStaff()">
                        <i class="bi bi-download"></i> 내보내기
                    </button>
                    <button class="btn btn-warning me-2" onclick="manageRoles()">
                        <i class="bi bi-gear"></i> 권한 관리
                    </button>
                    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#staffModal" onclick="openAddModal()">
                        <i class="bi bi-person-plus"></i> 직원 추가
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <!-- 통계 카드 -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="totalStaff">0</div>
                    <div class="stats-label">전체 직원</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number text-success" id="activeStaff">0</div>
                    <div class="stats-label">활성 계정</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number text-primary" id="adminStaff">0</div>
                    <div class="stats-label">관리자</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number text-info" id="professorStaff">0</div>
                    <div class="stats-label">교수</div>
                </div>
            </div>
        </div>

        <!-- 필터 및 검색 섹션 -->
        <div class="filter-section">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">검색</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchInput" placeholder="이름, 이메일, 직원번호 검색">
                        <button class="btn btn-outline-secondary" onclick="searchStaff()">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-2">
                    <label class="form-label">상태</label>
                    <select class="form-select" id="statusFilter" onchange="filterStaff()">
                        <option value="all">전체</option>
                        <option value="active">활성</option>
                        <option value="inactive">비활성</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">권한</label>
                    <select class="form-select" id="roleFilter" onchange="filterStaff()">
                        <option value="all">전체</option>
                        <option value="admin">최고관리자</option>
                        <option value="diagnosis">진단관리자</option>
                        <option value="counseling">상담관리자</option>
                        <option value="extracurricular">비교과관리자</option>
                        <option value="professor">교수</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">부서</label>
                    <select class="form-select" id="departmentFilter" onchange="filterStaff()">
                        <option value="all">전체</option>
                        <option value="admin">행정부</option>
                        <option value="academic">교무처</option>
                        <option value="student">학생처</option>
                        <option value="computer">컴퓨터공학과</option>
                        <option value="business">경영학과</option>
                        <option value="mechanical">기계공학과</option>
                        <option value="english">영어영문학과</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">직급</label>
                    <select class="form-select" id="positionFilter" onchange="filterStaff()">
                        <option value="all">전체</option>
                        <option value="professor">교수</option>
                        <option value="associate">부교수</option>
                        <option value="assistant">조교수</option>
                        <option value="lecturer">강사</option>
                        <option value="staff">직원</option>
                    </select>
                </div>
                <div class="col-md-1">
                    <label class="form-label">&nbsp;</label>
                    <button class="btn btn-secondary w-100" onclick="resetFilters()">
                        <i class="bi bi-arrow-clockwise"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- 일괄 작업 섹션 -->
        <div class="bulk-actions" id="bulkActions">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <span class="fw-bold">선택된 항목: <span id="selectedCount">0</span>개</span>
                </div>
                <div class="col-md-6 text-md-end">
                    <div class="btn-group">
                        <button class="btn btn-success btn-sm" onclick="bulkActivate()">
                            <i class="bi bi-check-circle"></i> 일괄 활성화
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="bulkDeactivate()">
                            <i class="bi bi-pause-circle"></i> 일괄 비활성화
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="bulkDelete()">
                            <i class="bi bi-trash"></i> 일괄 삭제
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 직원 목록 테이블 -->
        <div class="table-container">
            <div class="table-header">
                <h5 class="mb-0">직원 목록</h5>
                <div class="d-flex align-items-center">
                    <span class="text-muted me-3">총 <span id="filteredCount">0</span>명</span>
                    <select class="form-select form-select-sm" style="width: auto;" id="pageSize" onchange="changePageSize()">
                        <option value="10">10개씩</option>
                        <option value="25" selected>25개씩</option>
                        <option value="50">50개씩</option>
                        <option value="100">100개씩</option>
                    </select>
                </div>
            </div>
            
            <div class="table-responsive">
                <table class="table table-hover staff-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">
                                <input type="checkbox" class="form-check-input" id="selectAll" onchange="toggleSelectAll()">
                            </th>
                            <th style="width: 100px;">직원번호</th>
                            <th style="width: 100px;">이름</th>
                            <th style="width: 200px;">이메일</th>
                            <th style="width: 120px;">부서</th>
                            <th style="width: 100px;">직급</th>
                            <th style="width: 100px;">상태</th>
                            <th style="width: 200px;">권한</th>
                            <th style="width: 120px;">등록일</th>
                            <th style="width: 120px;">최종접속</th>
                            <th style="width: 150px;">관리</th>
                        </tr>
                    </thead>
                    <tbody id="staffTableBody">
                        <!-- 데이터가 여기에 동적으로 추가됩니다 -->
                    </tbody>
                </table>
            </div>

            <!-- 페이지네이션 -->
            <div class="pagination-container">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <span class="text-muted">
                            <span id="pageInfo">1-25 of 100</span> 항목 표시
                        </span>
                    </div>
                    <div class="col-md-6">
                        <nav>
                            <ul class="pagination pagination-sm justify-content-end mb-0" id="pagination">
                                <!-- 페이지네이션이 여기에 동적으로 추가됩니다 -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 직원 추가/수정 모달 -->
    <div class="modal fade" id="staffModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">직원 추가</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="staffForm">
                        <input type="hidden" id="staffId">
                        <div class="row g-3">
                            <!-- 기본 정보 -->
                            <div class="col-12">
                                <h6 class="border-bottom pb-2 mb-3">기본 정보</h6>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="staffNumber" required>
                                    <label for="staffNumber">직원번호 *</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="staffName" required>
                                    <label for="staffName">이름 *</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="email" class="form-control" id="staffEmail" required>
                                    <label for="staffEmail">이메일 *</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="tel" class="form-control" id="staffPhone">
                                    <label for="staffPhone">전화번호</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <select class="form-select" id="staffDepartment" required>
                                        <option value="">선택하세요</option>
                                        <option value="admin">행정부</option>
                                        <option value="academic">교무처</option>
                                        <option value="student">학생처</option>
                                        <option value="computer">컴퓨터공학과</option>
                                        <option value="business">경영학과</option>
                                        <option value="mechanical">기계공학과</option>
                                        <option value="english">영어영문학과</option>
                                    </select>
                                    <label for="staffDepartment">부서 *</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <select class="form-select" id="staffPosition" required>
                                        <option value="">선택하세요</option>
                                        <option value="professor">교수</option>
                                        <option value="associate">부교수</option>
                                        <option value="assistant">조교수</option>
                                        <option value="lecturer">강사</option>
                                        <option value="staff">직원</option>
                                    </select>
                                    <label for="staffPosition">직급 *</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <select class="form-select" id="staffStatus" required>
                                        <option value="active">활성</option>
                                        <option value="inactive">비활성</option>
                                    </select>
                                    <label for="staffStatus">상태 *</label>
                                </div>
                            </div>

                            <!-- 권한 설정 -->
                            <div class="col-12">
                                <h6 class="border-bottom pb-2 mb-3 mt-3">권한 설정</h6>
                            </div>
                            <div class="col-12">
                                <div class="role-selection">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="role-category">
                                                <h6><i class="bi bi-shield-check"></i> 관리자 권한</h6>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="role_admin" value="admin">
                                                    <label class="form-check-label" for="role_admin">
                                                        최고관리자
                                                    </label>
                                                    <div class="permission-item">
                                                        시스템 전체 관리, 사용자 계정 관리, 권한 설정
                                                    </div>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="role_diagnosis" value="diagnosis">
                                                    <label class="form-check-label" for="role_diagnosis">
                                                        진단관리자
                                                    </label>
                                                    <div class="permission-item">
                                                        핵심역량 진단 관리, 문항 관리, 결과 분석
                                                    </div>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="role_counseling" value="counseling">
                                                    <label class="form-check-label" for="role_counseling">
                                                        상담관리자
                                                    </label>
                                                    <div class="permission-item">
                                                        학생 상담 관리, 상담 일정 관리, 상담 기록
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="role-category">
                                                <h6><i class="bi bi-person-workspace"></i> 업무 권한</h6>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="role_extracurricular" value="extracurricular">
                                                    <label class="form-check-label" for="role_extracurricular">
                                                        비교과관리자
                                                    </label>
                                                    <div class="permission-item">
                                                        비교과 프로그램 관리, 활동 기록, 성과 분석
                                                    </div>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="role_professor" value="professor">
                                                    <label class="form-check-label" for="role_professor">
                                                        교수
                                                    </label>
                                                    <div class="permission-item">
                                                        학생 진단 결과 조회, 상담 기록 조회
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="form-floating">
                                    <textarea class="form-control" id="staffNotes" style="height: 100px;"></textarea>
                                    <label for="staffNotes">비고</label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" onclick="saveStaff()">저장</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 권한 관리 모달 -->
    <div class="modal fade" id="roleManagementModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">권한 관리</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>관리자 권한</h6>
                            <div class="list-group">
                                <div class="list-group-item">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">최고관리자</h6>
                                        <span class="badge bg-warning">고급</span>
                                    </div>
                                    <p class="mb-1">시스템 전체 관리 권한</p>
                                    <small>사용자 계정, 권한 설정, 시스템 설정</small>
                                </div>
                                <div class="list-group-item">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">진단관리자</h6>
                                        <span class="badge bg-primary">중급</span>
                                    </div>
                                    <p class="mb-1">핵심역량 진단 관리</p>
                                    <small>문항 관리, 진단 설정, 결과 분석</small>
                                </div>
                                <div class="list-group-item">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">상담관리자</h6>
                                        <span class="badge bg-info">중급</span>
                                    </div>
                                    <p class="mb-1">학생 상담 관리</p>
                                    <small>상담 일정, 상담 기록, 상담 분석</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>업무 권한</h6>
                            <div class="list-group">
                                <div class="list-group-item">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">비교과관리자</h6>
                                        <span class="badge bg-secondary">중급</span>
                                    </div>
                                    <p class="mb-1">비교과 프로그램 관리</p>
                                    <small>프로그램 등록, 활동 기록, 성과 분석</small>
                                </div>
                                <div class="list-group-item">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">교수</h6>
                                        <span class="badge bg-success">기본</span>
                                    </div>
                                    <p class="mb-1">학생 정보 조회</p>
                                    <small>진단 결과 조회, 상담 기록 조회</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">확인</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 직원 데이터
        let staff = [
            {
                id: 1,
                staffNumber: "EMP001",
                name: "김관리",
                email: "admin@university.ac.kr",
                phone: "02-1234-5678",
                department: "admin",
                departmentName: "행정부",
                position: "staff",
                positionName: "직원",
                status: "active",
                roles: ["admin"],
                registeredDate: "2024-01-01",
                lastAccess: "2024-04-16",
                notes: "시스템 최고관리자"
            },
            {
                id: 2,
                staffNumber: "EMP002",
                name: "이진단",
                email: "diagnosis@university.ac.kr",
                phone: "02-2345-6789",
                department: "academic",
                departmentName: "교무처",
                position: "staff",
                positionName: "직원",
                status: "active",
                roles: ["diagnosis"],
                registeredDate: "2024-01-15",
                lastAccess: "2024-04-15",
                notes: "핵심역량 진단 담당"
            },
            {
                id: 3,
                staffNumber: "EMP003",
                name: "박상담",
                email: "counseling@university.ac.kr",
                phone: "02-3456-7890",
                department: "student",
                departmentName: "학생처",
                position: "staff",
                positionName: "직원",
                status: "active",
                roles: ["counseling"],
                registeredDate: "2024-02-01",
                lastAccess: "2024-04-14",
                notes: "학생 상담 담당"
            },
            {
                id: 4,
                staffNumber: "PROF001",
                name: "최교수",
                email: "prof.choi@university.ac.kr",
                phone: "02-4567-8901",
                department: "computer",
                departmentName: "컴퓨터공학과",
                position: "professor",
                positionName: "교수",
                status: "active",
                roles: ["professor"],
                registeredDate: "2024-03-01",
                lastAccess: "2024-04-16",
                notes: ""
            },
            {
                id: 5,
                staffNumber: "EMP004",
                name: "정비교과",
                email: "extra@university.ac.kr",
                phone: "02-5678-9012",
                department: "student",
                departmentName: "학생처",
                position: "staff",
                positionName: "직원",
                status: "inactive",
                roles: ["extracurricular"],
                registeredDate: "2024-02-15",
                lastAccess: "2024-03-30",
                notes: "휴직 중"
            }
        ];

        let filteredStaff = [...staff];
        let selectedStaff = new Set();
        let currentPage = 1;
        let pageSize = 25;
        let editingStaff = null;

        // 권한 정보
        const roleInfo = {
            admin: { name: "최고관리자", class: "role-admin", description: "시스템 전체 관리" },
            diagnosis: { name: "진단관리자", class: "role-diagnosis", description: "핵심역량 진단 관리" },
            counseling: { name: "상담관리자", class: "role-counseling", description: "학생 상담 관리" },
            extracurricular: { name: "비교과관리자", class: "role-extracurricular", description: "비교과 프로그램 관리" },
            professor: { name: "교수", class: "role-professor", description: "학생 정보 조회" }
        };

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', () => {
            renderStaff();
            updateStats();
            updatePagination();
            
            // 검색 입력 이벤트
            document.getElementById('searchInput').addEventListener('input', debounce(searchStaff, 300));
        });

        // 직원 목록 렌더링
        function renderStaff() {
            const tbody = document.getElementById('staffTableBody');
            tbody.innerHTML = '';

            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pageStaff = filteredStaff.slice(startIndex, endIndex);

            if (pageStaff.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="text-center py-4 text-muted">
                            검색 결과가 없습니다.
                        </td>
                    </tr>
                `;
                return;
            }

            pageStaff.forEach(staffMember => {
                const rolesHtml = staffMember.roles.map(role => 
                    `<span class="role-badge ${roleInfo[role].class}">${roleInfo[role].name}</span>`
                ).join('');

                const row = `
                    <tr>
                        <td>
                            <input type="checkbox" class="form-check-input staff-checkbox" 
                                   value="${staffMember.id}" onchange="toggleStaffSelection(${staffMember.id})">
                        </td>
                        <td>${staffMember.staffNumber}</td>
                        <td>${staffMember.name}</td>
                        <td>${staffMember.email}</td>
                        <td>
                            <span class="department-badge">${staffMember.departmentName}</span>
                        </td>
                        <td>${staffMember.positionName}</td>
                        <td>
                            <span class="status-badge ${getStatusClass(staffMember.status)}">
                                ${getStatusText(staffMember.status)}
                            </span>
                        </td>
                        <td>${rolesHtml}</td>
                        <td>${formatDate(staffMember.registeredDate)}</td>
                        <td>${staffMember.lastAccess ? formatDate(staffMember.lastAccess) : '-'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-outline-primary btn-sm-custom" onclick="editStaff(${staffMember.id})" title="수정">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-outline-${staffMember.status === 'active' ? 'warning' : 'success'} btn-sm-custom" 
                                        onclick="toggleStatus(${staffMember.id})" title="${staffMember.status === 'active' ? '비활성화' : '활성화'}">
                                    <i class="bi bi-${staffMember.status === 'active' ? 'pause' : 'play'}-circle"></i>
                                </button>
                                <button class="btn btn-outline-danger btn-sm-custom" onclick="deleteStaff(${staffMember.id})" title="삭제">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            updateFilteredCount();
        }

        // 상태 클래스 반환
        function getStatusClass(status) {
            return status === 'active' ? 'status-active' : 'status-inactive';
        }

        // 상태 텍스트 반환
        function getStatusText(status) {
            return status === 'active' ? '활성' : '비활성';
        }

        // 날짜 포맷
        function formatDate(dateString) {
            if (!dateString) return '-';
            return new Date(dateString).toLocaleDateString('ko-KR');
        }

        // 통계 업데이트
        function updateStats() {
            document.getElementById('totalStaff').textContent = staff.length;
            document.getElementById('activeStaff').textContent = staff.filter(s => s.status === 'active').length;
            document.getElementById('adminStaff').textContent = staff.filter(s => s.roles.includes('admin')).length;
            document.getElementById('professorStaff').textContent = staff.filter(s => s.roles.includes('professor')).length;
        }

        // 필터링된 개수 업데이트
        function updateFilteredCount() {
            document.getElementById('filteredCount').textContent = filteredStaff.length;
        }

        // 직원 검색
        function searchStaff() {
            applyFilters();
        }

        // 필터 적용
        function filterStaff() {
            applyFilters();
        }

        // 모든 필터 적용
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            const statusFilter = document.getElementById('statusFilter').value;
            const roleFilter = document.getElementById('roleFilter').value;
            const departmentFilter = document.getElementById('departmentFilter').value;
            const positionFilter = document.getElementById('positionFilter').value;

            filteredStaff = staff.filter(staffMember => {
                const matchesSearch = !searchTerm || 
                    staffMember.staffNumber.toLowerCase().includes(searchTerm) ||
                    staffMember.name.toLowerCase().includes(searchTerm) ||
                    staffMember.email.toLowerCase().includes(searchTerm);

                const matchesStatus = statusFilter === 'all' || staffMember.status === statusFilter;
                const matchesRole = roleFilter === 'all' || staffMember.roles.includes(roleFilter);
                const matchesDepartment = departmentFilter === 'all' || staffMember.department === departmentFilter;
                const matchesPosition = positionFilter === 'all' || staffMember.position === positionFilter;

                return matchesSearch && matchesStatus && matchesRole && matchesDepartment && matchesPosition;
            });

            currentPage = 1;
            renderStaff();
            updatePagination();
        }

        // 필터 초기화
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('roleFilter').value = 'all';
            document.getElementById('departmentFilter').value = 'all';
            document.getElementById('positionFilter').value = 'all';
            
            filteredStaff = [...staff];
            currentPage = 1;
            renderStaff();
            updatePagination();
        }

        // 직원 선택 토글
        function toggleStaffSelection(id) {
            if (selectedStaff.has(id)) {
                selectedStaff.delete(id);
            } else {
                selectedStaff.add(id);
            }
            updateBulkActions();
            updateSelectAllCheckbox();
        }

        // 전체 선택 토글
        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.staff-checkbox');
            
            if (selectAll.checked) {
                checkboxes.forEach(checkbox => {
                    checkbox.checked = true;
                    selectedStaff.add(parseInt(checkbox.value));
                });
            } else {
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                    selectedStaff.delete(parseInt(checkbox.value));
                });
            }
            updateBulkActions();
        }

        // 전체 선택 체크박스 상태 업데이트
        function updateSelectAllCheckbox() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.staff-checkbox');
            const checkedBoxes = document.querySelectorAll('.staff-checkbox:checked');
            
            if (checkedBoxes.length === 0) {
                selectAll.indeterminate = false;
                selectAll.checked = false;
            } else if (checkedBoxes.length === checkboxes.length) {
                selectAll.indeterminate = false;
                selectAll.checked = true;
            } else {
                selectAll.indeterminate = true;
                selectAll.checked = false;
            }
        }

        // 일괄 작업 UI 업데이트
        function updateBulkActions() {
            const bulkActions = document.getElementById('bulkActions');
            const selectedCount = document.getElementById('selectedCount');
            
            selectedCount.textContent = selectedStaff.size;
            
            if (selectedStaff.size > 0) {
                bulkActions.classList.add('show');
            } else {
                bulkActions.classList.remove('show');
            }
        }

        // 페이지네이션 업데이트
        function updatePagination() {
            const totalPages = Math.ceil(filteredStaff.length / pageSize);
            const pagination = document.getElementById('pagination');
            const pageInfo = document.getElementById('pageInfo');
            
            // 페이지 정보 업데이트
            const startItem = (currentPage - 1) * pageSize + 1;
            const endItem = Math.min(currentPage * pageSize, filteredStaff.length);
            pageInfo.textContent = `${startItem}-${endItem} of ${filteredStaff.length}`;
            
            // 페이지네이션 버튼 생성
            pagination.innerHTML = '';
            
            // 이전 버튼
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage - 1})">이전</a>`;
            pagination.appendChild(prevLi);
            
            // 페이지 번호
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
                pagination.appendChild(li);
            }
            
            // 다음 버튼
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage + 1})">다음</a>`;
            pagination.appendChild(nextLi);
        }

        // 페이지 변경
        function changePage(page) {
            const totalPages = Math.ceil(filteredStaff.length / pageSize);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderStaff();
                updatePagination();
                selectedStaff.clear();
                updateBulkActions();
            }
        }

        // 페이지 크기 변경
        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSize').value);
            currentPage = 1;
            renderStaff();
            updatePagination();
        }

        // 직원 추가 모달 열기
        function openAddModal() {
            editingStaff = null;
            document.getElementById('modalTitle').textContent = '직원 추가';
            document.getElementById('staffForm').reset();
            document.getElementById('staffId').value = '';
            
            // 모든 권한 체크박스 해제
            document.querySelectorAll('input[id^="role_"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        // 직원 수정
        function editStaff(id) {
            editingStaff = staff.find(s => s.id === id);
            if (!editingStaff) return;

            document.getElementById('modalTitle').textContent = '직원 수정';
            document.getElementById('staffId').value = editingStaff.id;
            document.getElementById('staffNumber').value = editingStaff.staffNumber;
            document.getElementById('staffName').value = editingStaff.name;
            document.getElementById('staffEmail').value = editingStaff.email;
            document.getElementById('staffPhone').value = editingStaff.phone || '';
            document.getElementById('staffDepartment').value = editingStaff.department;
            document.getElementById('staffPosition').value = editingStaff.position;
            document.getElementById('staffStatus').value = editingStaff.status;
            document.getElementById('staffNotes').value = editingStaff.notes || '';

            // 권한 체크박스 설정
            document.querySelectorAll('input[id^="role_"]').forEach(checkbox => {
                checkbox.checked = editingStaff.roles.includes(checkbox.value);
            });

            new bootstrap.Modal(document.getElementById('staffModal')).show();
        }

        // 직원 저장
        function saveStaff() {
            const form = document.getElementById('staffForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // 선택된 권한 수집
            const selectedRoles = [];
            document.querySelectorAll('input[id^="role_"]:checked').forEach(checkbox => {
                selectedRoles.push(checkbox.value);
            });

            if (selectedRoles.length === 0) {
                alert('최소 하나의 권한을 선택해주세요.');
                return;
            }

            const staffData = {
                staffNumber: document.getElementById('staffNumber').value,
                name: document.getElementById('staffName').value,
                email: document.getElementById('staffEmail').value,
                phone: document.getElementById('staffPhone').value,
                department: document.getElementById('staffDepartment').value,
                departmentName: getDepartmentName(document.getElementById('staffDepartment').value),
                position: document.getElementById('staffPosition').value,
                positionName: getPositionName(document.getElementById('staffPosition').value),
                status: document.getElementById('staffStatus').value,
                roles: selectedRoles,
                notes: document.getElementById('staffNotes').value
            };

            // 중복 직원번호 체크
            const existingStaff = staff.find(s => 
                s.staffNumber === staffData.staffNumber && 
                s.id !== (editingStaff ? editingStaff.id : null)
            );
            
            if (existingStaff) {
                alert('이미 존재하는 직원번호입니다.');
                return;
            }

            if (editingStaff) {
                // 수정
                const index = staff.findIndex(s => s.id === editingStaff.id);
                staff[index] = { ...staff[index], ...staffData };
            } else {
                // 추가
                const newStaff = {
                    id: Math.max(...staff.map(s => s.id)) + 1,
                    ...staffData,
                    registeredDate: new Date().toISOString().split('T')[0],
                    lastAccess: null
                };
                staff.push(newStaff);
            }

            applyFilters();
            updateStats();
            bootstrap.Modal.getInstance(document.getElementById('staffModal')).hide();
            
            showToast(editingStaff ? '직원 정보가 수정되었습니다.' : '새 직원이 추가되었습니다.', 'success');
        }

        // 부서명 반환
        function getDepartmentName(departmentCode) {
            const departmentMap = {
                'admin': '행정부',
                'academic': '교무처',
                'student': '학생처',
                'computer': '컴퓨터공학과',
                'business': '경영학과',
                'mechanical': '기계공학과',
                'english': '영어영문학과'
            };
            return departmentMap[departmentCode] || departmentCode;
        }

        // 직급명 반환
        function getPositionName(positionCode) {
            const positionMap = {
                'professor': '교수',
                'associate': '부교수',
                'assistant': '조교수',
                'lecturer': '강사',
                'staff': '직원'
            };
            return positionMap[positionCode] || positionCode;
        }

        // 상태 토글
        function toggleStatus(id) {
            const staffMember = staff.find(s => s.id === id);
            if (!staffMember) return;

            const newStatus = staffMember.status === 'active' ? 'inactive' : 'active';
            const action = newStatus === 'active' ? '활성화' : '비활성화';
            
            if (confirm(`"${staffMember.name}" 직원을 ${action}하시겠습니까?`)) {
                staffMember.status = newStatus;
                applyFilters();
                updateStats();
                showToast(`직원이 ${action}되었습니다.`, 'success');
            }
        }

        // 직원 삭제
        function deleteStaff(id) {
            const staffMember = staff.find(s => s.id === id);
            if (!staffMember) return;

            if (confirm(`"${staffMember.name}" 직원을 삭제하시겠습니까?\n\n삭제된 데이터는 복구할 수 없습니다.`)) {
                staff = staff.filter(s => s.id !== id);
                selectedStaff.delete(id);
                applyFilters();
                updateStats();
                updateBulkActions();
                showToast('직원이 삭제되었습니다.', 'success');
            }
        }

        // 일괄 활성화
        function bulkActivate() {
            if (selectedStaff.size === 0) return;
            
            if (confirm(`선택된 ${selectedStaff.size}명의 직원을 활성화하시겠습니까?`)) {
                selectedStaff.forEach(id => {
                    const staffMember = staff.find(s => s.id === id);
                    if (staffMember) staffMember.status = 'active';
                });
                
                selectedStaff.clear();
                applyFilters();
                updateStats();
                updateBulkActions();
                showToast('선택된 직원들이 활성화되었습니다.', 'success');
            }
        }

        // 일괄 비활성화
        function bulkDeactivate() {
            if (selectedStaff.size === 0) return;
            
            if (confirm(`선택된 ${selectedStaff.size}명의 직원을 비활성화하시겠습니까?`)) {
                selectedStaff.forEach(id => {
                    const staffMember = staff.find(s => s.id === id);
                    if (staffMember) staffMember.status = 'inactive';
                });
                
                selectedStaff.clear();
                applyFilters();
                updateStats();
                updateBulkActions();
                showToast('선택된 직원들이 비활성화되었습니다.', 'success');
            }
        }

        // 일괄 삭제
        function bulkDelete() {
            if (selectedStaff.size === 0) return;
            
            if (confirm(`선택된 ${selectedStaff.size}명의 직원을 삭제하시겠습니까?\n\n삭제된 데이터는 복구할 수 없습니다.`)) {
                staff = staff.filter(s => !selectedStaff.has(s.id));
                selectedStaff.clear();
                applyFilters();
                updateStats();
                updateBulkActions();
                showToast('선택된 직원들이 삭제되었습니다.', 'success');
            }
        }

        // 권한 관리 모달
        function manageRoles() {
            new bootstrap.Modal(document.getElementById('roleManagementModal')).show();
        }

        // 데이터 내보내기
        function exportStaff() {
            const csvContent = generateCSV(filteredStaff);
            downloadCSV(csvContent, 'staff.csv');
            showToast('직원 데이터가 내보내기되었습니다.', 'success');
        }

        // CSV 생성
        function generateCSV(data) {
            const headers = ['직원번호', '이름', '이메일', '전화번호', '부서', '직급', '상태', '권한', '등록일', '최종접속'];
            const rows = data.map(staffMember => [
                staffMember.staffNumber,
                staffMember.name,
                staffMember.email,
                staffMember.phone || '',
                staffMember.departmentName,
                staffMember.positionName,
                getStatusText(staffMember.status),
                staffMember.roles.map(role => roleInfo[role].name).join(', '),
                staffMember.registeredDate,
                staffMember.lastAccess || ''
            ]);
            
            return [headers, ...rows].map(row => row.join(',')).join('\n');
        }

        // CSV 다운로드
        function downloadCSV(content, filename) {
            const blob = new Blob(['\uFEFF' + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        // 토스트 메시지
        function showToast(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type === 'success' ? 'success' : 'info'} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }

        // 디바운스 함수
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>