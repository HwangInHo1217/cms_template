<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>핵심역량 진단 결과</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .section-header {
            background-color: #ff8c00;
            color: white;
            padding: 8px 15px;
            font-weight: bold;
            border-left: 4px solid #ff6600;
        }
        
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }
        
        .selected-row {
            background-color: #007bff !important;
            color: white;
        }
        
        .competency-table th {
            background-color: #f8f9fa;
            font-size: 0.9em;
            text-align: center;
            vertical-align: middle;
        }
        
        .competency-table td {
            text-align: center;
            vertical-align: middle;
            font-size: 0.9em;
        }
        
        .score-cell {
            font-weight: bold;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
        
        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .sub-competency-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .export-btn {
            position: absolute;
            top: 10px;
            right: 10px;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-3">
        <!-- 진단정보 섹션 -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="section-header d-flex justify-content-between align-items-center">
                    <span>진단정보 <span class="badge bg-light text-dark ms-2">510 건</span></span>
                    <button class="btn btn-sm btn-light export-btn">
                        <i class="bi bi-file-earmark-excel"></i>
                    </button>
                </div>
                <div class="table-container">
                    <table class="table table-sm table-hover competency-table mb-0">
                        <thead class="sticky-top">
                            <tr>
                                <th rowspan="2" style="width: 5%">No.</th>
                                <th rowspan="2" style="width: 12%">학부(과)</th>
                                <th rowspan="2" style="width: 5%">학년</th>
                                <th rowspan="2" style="width: 8%">학번</th>
                                <th rowspan="2" style="width: 5%">성명</th>
                                <th colspan="4" style="width: 50%">핵심역량</th>
                                <th rowspan="2" style="width: 8%">합계</th>
                                <th rowspan="2" style="width: 7%">평균</th>
                            </tr>
                            <tr>
                                <th style="width: 12.5%">1. 창의융합형 문제해결역량</th>
                                <th style="width: 12.5%">2. 도전지향형 학습리더역량</th>
                                <th style="width: 12.5%">3. 현장실무형 전공역량</th>
                                <th style="width: 12.5%">4. 나우리형 인성역량</th>
                            </tr>
                        </thead>
                        <tbody id="diagnosisTableBody">
                            <!-- 데이터가 여기에 동적으로 추가됩니다 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- 좌측 섹션 -->
            <div class="col-lg-8">
                <!-- 핵심역량 진단결과 -->
                <div class="mb-3">
                    <div class="section-header">
                        핵심역량 진단결과 <span class="badge bg-light text-dark ms-2">4 건</span>
                    </div>
                    <div class="table-container">
                        <table class="table table-sm table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 10%">코드</th>
                                    <th style="width: 70%">핵심역량명</th>
                                    <th style="width: 20%">진단평균</th>
                                </tr>
                            </thead>
                            <tbody id="coreCompetencyTableBody">
                                <!-- 데이터가 여기에 동적으로 추가됩니다 -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 하위역량 진단결과 -->
                <div class="sub-competency-section">
                    <div class="section-header">
                        하위역량 진단결과 <span class="badge bg-light text-dark ms-2" id="subCompetencyCount">12 건</span>
                    </div>
                    <div class="table-container mt-2">
                        <table class="table table-sm table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 40%">핵심역량</th>
                                    <th style="width: 15%">코드</th>
                                    <th style="width: 30%">하위핵심역량</th>
                                    <th style="width: 15%">진단평균</th>
                                </tr>
                            </thead>
                            <tbody id="subCompetencyTableBody">
                                <!-- 데이터가 여기에 동적으로 추가됩니다 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 우측 차트 섹션 -->
            <div class="col-lg-4">
                <div class="section-header">
                    그래프 분석
                </div>
                <div class="card">
                    <div class="card-body">
                        <div class="radio-group">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="chartType" id="coreCompetency" value="core" checked>
                                <label class="form-check-label" for="coreCompetency">핵심역량</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="chartType" id="subCompetency" value="sub">
                                <label class="form-check-label" for="subCompetency">하위역량</label>
                            </div>
                        </div>
                        
                        <div class="chart-container">
                            <canvas id="competencyChart"></canvas>
                        </div>
                        
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #ff6384;"></div>
                                <span>전공</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #36a2eb;"></div>
                                <span>학과</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #4bc0c0;"></div>
                                <span>전체</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 샘플 데이터
        const diagnosisData = [
            {
                no: 1,
                department: '컴퓨터공학부',
                grade: 4,
                studentId: '2012136042',
                name: '학생15117',
                scores: [6.77, 6.93, 0, 6.23],
                total: 19.93,
                average: 6.64
            },
            {
                no: 2,
                department: '메카트로닉스공학부',
                grade: 4,
                studentId: '2012140014',
                name: '학생15559',
                scores: [6.37, 5.53, 0, 4.43],
                total: 16.33,
                average: 5.44
            },
            {
                no: 3,
                department: '메카트로닉스공학부',
                grade: 4,
                studentId: '2012140092',
                name: '학생14929',
                scores: [6.3, 5.9, 0, 6.1],
                total: 18.3,
                average: 6.1
            },
            {
                no: 4,
                department: '기계공학부',
                grade: 4,
                studentId: '2013120004',
                name: '학생15795',
                scores: [5.53, 5.17, 0, 5.7],
                total: 16.4,
                average: 5.47
            },
            {
                no: 5,
                department: '기계공학부',
                grade: 4,
                studentId: '2013120030',
                name: '학생15904',
                scores: [6.2, 6.03, 0, 6.1],
                total: 18.33,
                average: 6.11
            }
        ];

        const coreCompetencies = [
            { code: 1, name: '1. 창의융합형 문제해결역량', average: 6.37 },
            { code: 2, name: '2. 도전지향형 학습리더역량', average: 5.53 },
            { code: 3, name: '3. 현장실무형 전공역량', average: 0 },
            { code: 4, name: '4. 나우리형 인성역량', average: 4.43 }
        ];

        const subCompetencies = [
            { coreCompetency: '2. 도전지향형 학습리더역량', code: '22', name: '2-2. 학습지도', average: 4.3 },
            { coreCompetency: '2. 도전지향형 학습리더역량', code: '23', name: '2-3. 글로벌', average: 5.8 },
            { coreCompetency: '3. 현장실무형 전공역량', code: '31', name: '3-1. 전공기초활용', average: 0 },
            { coreCompetency: '3. 현장실무형 전공역량', code: '32', name: '3-2. 전공전문성', average: 0 },
            { coreCompetency: '3. 현장실무형 전공역량', code: '33', name: '3-3. 실무활용', average: 0 },
            { coreCompetency: '4. 나우리형 인성역량', code: '41', name: '4-1. 자기관리', average: 4.2 },
            { coreCompetency: '4. 나우리형 인성역량', code: '42', name: '4-2. 소통협력', average: 4.8 },
            { coreCompetency: '4. 나우리형 인성역량', code: '43', name: '4-3. 나눔배려', average: 4.3 }
        ];

        let selectedRowIndex = 1; // 기본 선택된 행 (2번째 행)
        let chart = null;

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', () => {
            renderDiagnosisTable();
            renderCoreCompetencyTable();
            renderSubCompetencyTable();
            initChart();
            
            // 라디오 버튼 이벤트 리스너
            document.querySelectorAll('input[name="chartType"]').forEach(radio => {
                radio.addEventListener('change', updateChart);
            });
        });

        // 진단정보 테이블 렌더링
        function renderDiagnosisTable() {
            const tbody = document.getElementById('diagnosisTableBody');
            tbody.innerHTML = '';

            diagnosisData.forEach((data, index) => {
                const isSelected = index === selectedRowIndex;
                const row = `
                    <tr class="${isSelected ? 'selected-row' : ''}" onclick="selectRow(${index})">
                        <td>${data.no}</td>
                        <td>${data.department}</td>
                        <td>${data.grade}</td>
                        <td>${data.studentId}</td>
                        <td>${data.name}</td>
                        <td class="score-cell">${data.scores[0]}</td>
                        <td class="score-cell">${data.scores[1]}</td>
                        <td class="score-cell">${data.scores[2]}</td>
                        <td class="score-cell">${data.scores[3]}</td>
                        <td class="score-cell">${data.total}</td>
                        <td class="score-cell">${data.average}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // 핵심역량 테이블 렌더링
        function renderCoreCompetencyTable() {
            const tbody = document.getElementById('coreCompetencyTableBody');
            tbody.innerHTML = '';

            coreCompetencies.forEach((competency, index) => {
                const isSelected = index === 3; // 4번째 항목 선택
                const row = `
                    <tr class="${isSelected ? 'selected-row' : ''}">
                        <td>${competency.code}</td>
                        <td>${competency.name}</td>
                        <td class="score-cell">${competency.average}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // 하위역량 테이블 렌더링
        function renderSubCompetencyTable() {
            const tbody = document.getElementById('subCompetencyTableBody');
            tbody.innerHTML = '';

            subCompetencies.forEach((competency, index) => {
                const isSelected = index === 1; // 2번째 항목 선택
                const row = `
                    <tr class="${isSelected ? 'selected-row' : ''}">
                        <td>${competency.coreCompetency}</td>
                        <td>${competency.code}</td>
                        <td>${competency.name}</td>
                        <td class="score-cell">${competency.average}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // 행 선택
        function selectRow(index) {
            selectedRowIndex = index;
            renderDiagnosisTable();
            updateChart();
        }

        // 차트 초기화
        function initChart() {
            const ctx = document.getElementById('competencyChart').getContext('2d');
            
            const data = {
                labels: [
                    '1. 창의융합형 문제해결역량',
                    '2. 도전지향형 학습리더역량',
                    '3. 현장실무형 전공역량',
                    '4. 나우리형 인성역량'
                ],
                datasets: [
                    {
                        label: '전공',
                        data: [6.5, 5.8, 2.5, 4.8],
                        borderColor: '#ff6384',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        pointBackgroundColor: '#ff6384',
                        pointBorderColor: '#ff6384',
                        pointRadius: 5
                    },
                    {
                        label: '학과',
                        data: [6.2, 5.5, 2.0, 4.5],
                        borderColor: '#36a2eb',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        pointBackgroundColor: '#36a2eb',
                        pointBorderColor: '#36a2eb',
                        pointRadius: 5
                    },
                    {
                        label: '전체',
                        data: [6.0, 5.3, 1.8, 4.2],
                        borderColor: '#4bc0c0',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        pointBackgroundColor: '#4bc0c0',
                        pointBorderColor: '#4bc0c0',
                        pointRadius: 5
                    }
                ]
            };

            const config = {
                type: 'radar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 2.5,
                                font: {
                                    size: 10
                                }
                            },
                            pointLabels: {
                                font: {
                                    size: 10
                                },
                                callback: function(label) {
                                    // 긴 라벨을 줄여서 표시
                                    if (label.length > 15) {
                                        return label.substring(0, 15) + '...';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            };

            chart = new Chart(ctx, config);
        }

        // 차트 업데이트
        function updateChart() {
            if (!chart) return;

            const chartType = document.querySelector('input[name="chartType"]:checked').value;
            const selectedData = diagnosisData[selectedRowIndex];

            if (chartType === 'core') {
                // 핵심역량 차트 데이터
                chart.data.labels = [
                    '1. 창의융합형 문제해결역량',
                    '2. 도전지향형 학습리더역량',
                    '3. 현장실무형 전공역량',
                    '4. 나우리형 인성역량'
                ];
                
                chart.data.datasets[0].data = [selectedData.scores[0], selectedData.scores[1], selectedData.scores[2], selectedData.scores[3]];
                chart.data.datasets[1].data = [6.2, 5.5, 2.0, 4.5];
                chart.data.datasets[2].data = [6.0, 5.3, 1.8, 4.2];
            } else {
                // 하위역량 차트 데이터 (예시)
                chart.data.labels = [
                    '2-2. 학습지도',
                    '2-3. 글로벌',
                    '4-1. 자기관리',
                    '4-2. 소통협력'
                ];
                
                chart.data.datasets[0].data = [4.3, 5.8, 4.2, 4.8];
                chart.data.datasets[1].data = [4.0, 5.5, 4.0, 4.5];
                chart.data.datasets[2].data = [3.8, 5.2, 3.8, 4.2];
            }

            chart.update();
        }
    </script>
</body>
</html>